#!/bin/bash

# Import Colors
source ~/CLI-GPT/extras/colors

echo -e "\n${Cyan}Welcome to the first time setup for CLI-GPT!${Off}\n"

# Install required packages
# sudo apt install python3-pip -y
pip3 install openai
pip3 install colorama

# Give script perms
chmod +x /home/$USER/CLI-GPT/update
chmod +x /home/$USER/CLI-GPT/change-engine
chmod +x /home/$USER/CLI-GPT/tone
chmod +x /home/$USER/CLI-GPT/extras/defaults

# Ask for API Key
echo -e "${Y}"
read -p "Please enter your OpenAI API key ('CTRL + SHIFT + V' to paste): " key
echo -e "${Off}"

# Replace the API key in gpt.py
sed -i "s/openai.api_key = \"\"/openai.api_key = \"$key\"/" /home/$USER/CLI-GPT/gpt.py

echo -e "${G}API key successfully updated in 'gpt.py'${Y}"

if [ -f ~/.bash_aliases ]; then
    echo -e "Please understand '~/.bash_aliases' will be overwritten! This is recommended for most users. "
    read -p "Do wish to continue? (Y/n): " overwrite_aliases
    if [ "$overwrite_aliases" == "n" ] || [ "$overwrite_aliases" == "N" ]; then
        echo -e "${R}NOTICE: setup will continue, but will have to execute commands manually (bash ~/CLI-GPT/gpt)!${Off}"
    else
        echo -e "alias gpt='python3 ~/CLI-GPT/gpt.py'" > ~/.bash_aliases
        echo -e "alias gpt-update='bash ~/CLI-GPT/update'" >> ~/.bash_aliases
        echo -e "alias gpt-engine='bash ~/CLI-GPT/change-engine'" >> ~/.bash_aliases
        echo -e "alias gpt-tone='bash ~/CLI-GPT/tone'" >> ~/.bash_aliases
        echo -e "alias gpt-default='bash ~/CLI-GPT/extras/defaults'" >> ~/.bash_aliases
        echo -e "${G}Aliases added successfully.${Off}"
    fi
else
    echo -e "alias gpt='python3 ~/CLI-GPT/gpt.py'" > ~/.bash_aliases
    echo -e "alias gpt-update='bash ~/CLI-GPT/update'" >> ~/.bash_aliases
    echo -e "alias gpt-engine='bash ~/CLI-GPT/change-engine'" >> ~/.bash_aliases
    echo -e "alias gpt-tone='bash ~/CLI-GPT/tone'" >> ~/.bash_aliases
    echo -e "alias gpt-default='bash ~/CLI-GPT/extras/defaults'" >> ~/.bash_aliases
    echo -e "${G}Aliases added successfully in '~/.bash_aliases'${Off}"
fi

# List commands
echo -e "${G}Setup complete!${Off}\n"
echo -e "${B}Commands:"        
echo -e "gpt           - begin ChatGPT conversation"
echo -e "gpt-update    - update CLI-GPT code"
echo -e "gpt-tone      - change ChatGPT's tone and writing style"
echo -e "gpt-engine    - change OpenAI engine"
echo -e "gpt-default   - revert engine, tone, and writing style to defaults${Off}"

cd /home/$USER/
source .bashrc
