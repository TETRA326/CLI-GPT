#!/bin/bash
Off='\033[0m'
# Regular Colors
Black='\033[0;30m'        # Black
R='\033[0;31m'          # Red
G='\033[0;32m'        # Green
Y='\033[0;33m'       # Yellow
B='\033[0;34m'         # Blue
P='\033[0;35m'       # Purple
Cyan='\033[0;36m'         # Cyan
# Bold
BBlack='\033[1;30m'       # Black
BRed='\033[1;31m'         # Red
BGreen='\033[1;32m'       # Green
BYellow='\033[1;33m'      # Yellow
BBlue='\033[1;34m'        # Blue
BPurple='\033[1;35m'      # Purple
BCyan='\033[1;36m'        # Cyan
BWhite='\033[1;37m'       # White
# Background
On_Black='\033[40m'       # Black
On_Red='\033[41m'         # Red
On_Green='\033[42m'       # Green
On_Yellow='\033[43m'      # Yellow
On_Blue='\033[44m'        # Blue
On_Purple='\033[45m'      # Purple
On_Cyan='\033[46m'        # Cyan
On_White='\033[47m'       # White

echo -e "\n${Cyan}Welcome to the first time setup for CLI-GPT!${Off}\n"

# Install required packages
# sudo apt-get update
# sudo apt-get install python3-pip -y
pip3 install openai
pip3 install colorama

# Give script perms
chmod +x /home/$USER/CLI-GPT/gpt
chmod +x /home/$USER/CLI-GPT/update
chmod +x /home/$USER/CLI-GPT/change-engine
chmod +x /home/$USER/CLI-GPT/tone

echo -e "${Y}"
read -p "Please enter your OpenAI API key ('CTRL + SHIFT + V' to paste): " key
echo -e "${Off}"

# Replace the API key in gpt.py
sed -i "s/openai.api_key = \"\"/openai.api_key = \"$key\"/" /home/$USER/CLI-GPT/gpt.py

echo -e "${G}API key successfully updated in 'gpt.py'${Y}"

echo -e "Please understand '~/.bash_aliases' will be overwritten! This is recommended for most users. "
read -p "Do wish to continue? (Y/n): " overwrite_aliases

if [ "$overwrite_aliases" == "n" ] || [ "$overwrite_aliases" == "N" ]; then
    echo -e "${R}NOTICE: setup will continue, but will have to execute commands manually (bash ~/CLI-GPT/gpt)!${Off}"
else
    echo -e "alias gpt='python3 ~/CLI-GPT/gpt.py'\nalias gpt-update='bash ~/CLI-GPT/update'\nalias gpt-engine='bash ~/CLI-GPT/change-engine'\nalias gpt-tone='bash ~/CLI-GPT/tone'" > ~/.bash_aliases
    echo -e "${G}Aliases added successfully.${Off}"
fi

echo -e "${G}Setup complete!${Off}\n"
echo -e "${B}Commands:"        
echo -e "gpt           - begin ChatGPT conversation"
echo -e "gpt-update    - update CLI-GPT code"
echo -e "gpt-tone      - change ChatGPT's tone and writing style"
echo -e "gpt-engine    - change OpenAI engine${Off}"

cd /home/$USER/
bash
